<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Admin - Aura Realty</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Iconos -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    font-family: 'Inter', sans-serif;
    background: #f5f6fa;
    padding: 30px;
}

/* TARJETAS WIDGET */
.widget {
    border-radius: 12px;
    padding: 20px;
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 4px 8px rgba(0,0,0,0.05);
}

.widget i {
    font-size: 40px;
    opacity: 0.3;
}

.widget .info {
    text-align: right;
}

.widget .info h4 {
    margin: 0;
    font-size: 24px;
}

.widget .info p {
    margin: 0;
    font-size: 14px;
    opacity: 0.8;
}

.widget.bg-blue { background: #0c63e7; }
.widget.bg-green { background: #16a34a; }
.widget.bg-orange { background: #f97316; }
.widget.bg-red { background: #dc2626; }

/* TOP AGENTES */
.top-agentes {
    max-height: 300px;
    overflow-y: auto;
    margin-top: 10px;
}

.top-agentes li {
    padding: 10px;
    border-bottom: 1px solid #e5e7eb;
    display: flex;
    justify-content: space-between;
}

.top-agentes li:last-child { border-bottom: none; }
</style>
</head>

<body>

<div class="container-fluid">
    <h3 class="fw-bold mb-4">Bienvenido, Administrador</h3>

    <!-- ================= WIDGETS ================= -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="widget bg-blue">
                <i class="fa-solid fa-users"></i>
                <div class="info">
                    <p>Agentes</p>
                    <h4 id="countAgentes">0</h4>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="widget bg-green">
                <i class="fa-solid fa-house"></i>
                <div class="info">
                    <p>Propiedades Activas</p>
                    <h4 id="countPropActivas">0</h4>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="widget bg-orange">
                <i class="fa-solid fa-calendar-check"></i>
                <div class="info">
                    <p>Citas Hoy</p>
                    <h4 id="countCitasHoy">0</h4>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="widget bg-red">
                <i class="fa-solid fa-house-chimney-crack"></i>
                <div class="info">
                    <p>Propiedades Vendidas</p>
                    <h4 id="countVendidas">0</h4>
                </div>
            </div>
        </div>
    </div>

    <!-- ================= GRAFICOS ================= -->
    <div class="row g-4">
        <!-- Citas últimos 7 días -->
        <div class="col-lg-6">
            <div class="card p-3 shadow-sm">
                <h5>Citas Últimos 7 Días</h5>
                <canvas id="citas7diasChart" height="200"></canvas>
            </div>
        </div>

        <!-- Top 5 agentes con más citas -->
        <div class="col-lg-6">
            <div class="card p-3 shadow-sm">
                <h5>Top 5 Agentes (más citas)</h5>
                <ul class="top-agentes list-unstyled" id="topAgentes"></ul>
            </div>
        </div>
    </div>
</div>

<script>
// =======================
// CARGAR METRICS DESDE metrics.php
// =======================
async function loadMetrics() {
    try {
        const res = await fetch('/TALLER/aura-realty/api/dashboard/metrics.php');
        const data = await res.json();

        // Contadores
        document.getElementById("countAgentes").textContent = data.agentes;
        document.getElementById("countPropActivas").textContent = data.propiedades_activas;
        document.getElementById("countCitasHoy").textContent = data.citas_hoy;
        document.getElementById("countVendidas").textContent = data.propiedades_vendidas;

        // Citas últimos 7 días - Chart.js
        const ctx = document.getElementById("citas7diasChart").getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.citas_7dias.labels,
                datasets: [{
                    label: 'Citas',
                    data: data.citas_7dias.values,
                    backgroundColor: '#0c63e7'
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } }
            }
        });

        // Top 5 agentes con más citas
        const topAgentesEl = document.getElementById("topAgentes");
        topAgentesEl.innerHTML = '';
        data.top_agentes.forEach(a => {
            const li = document.createElement('li');
            li.innerHTML = `<span>${a.nombre}</span><span>${a.citas} citas</span>`;
            topAgentesEl.appendChild(li);
        });

    } catch (error) {
        console.error(error);
    }
}

loadMetrics();
</script>

</body>
</html>
