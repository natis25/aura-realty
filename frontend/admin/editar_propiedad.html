<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Editar Propiedad</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">

<h3>Editar Propiedad</h3>

<form id="form">
  <input type="hidden" id="id">

  <label>Título:</label>
  <input id="titulo" class="form-control mb-2">

  <label>Dirección:</label>
  <input id="direccion" class="form-control mb-2">

  <label>Precio:</label>
  <input id="precio" type="number" class="form-control mb-2">

  <label>Tipo:</label>
  <select id="tipo" class="form-control mb-2">
    <option value="casa">Casa</option>
    <option value="departamento">Departamento</option>
    <option value="terreno">Terreno</option>
  </select>

  <button class="btn btn-primary mt-3">Guardar Cambios</button>
</form>

<script>
// obtener ID desde URL
const params = new URLSearchParams(window.location.search);
const id = params.get("id");
document.getElementById("id").value = id;

async function cargarDatos(){
  const res = await fetch(`/api/propiedades/listar.php?id=${id}`,{
    headers:{'Authorization':'Bearer '+localStorage.getItem('token')}
  });
  const data = await res.json();

  const p = data.propiedad;
  titulo.value = p.titulo;
  direccion.value = p.direccion;
  precio.value = p.precio;
  tipo.value = p.tipo;
}

document.getElementById("form").addEventListener("submit", async e=>{
  e.preventDefault();

  const res = await fetch('/api/propiedades/actualizar.php',{
    method:'POST',
    headers:{'Content-Type':'application/json','Authorization':'Bearer '+localStorage.getItem('token')},
    body:JSON.stringify({
      id,
      titulo:titulo.value,
      direccion:direccion.value,
      precio:precio.value,
      tipo:tipo.value
    })
  });
  const data = await res.json();
  alert(data.mensaje || data.error);
});

cargarDatos();
</script>
</body>
</html>
